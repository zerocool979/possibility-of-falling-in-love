<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Compatibility Analyzer | Prediksi Kecocokan Pasangan</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght=700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Link ke file CSS eksternal -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/komponen.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Add Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Audio -->
    <audio id="audio" src="{{ url_for('static', filename='audio/audio.mp3') }}" autoplay loop></audio>

    <!-- Floating hearts background container -->
    <div id="floating-hearts-container"></div>

    <!-- Loading overlay -->
    <div id="loadingOverlay">
        <div class="spinner">
            <div class="heart-spinner">
                <i class="fas fa-heart"></i>
                <i class="fas fa-heart"></i>
                <i class="fas fa-heart"></i>
            </div>
        </div>
        <p class="loading-text">Menganalisis kecocokan kalian...</p>
    </div>

    <div class="container">
        <!-- Progress indicator -->
        <div class="progress-indicator">
            <div class="progress-bar"></div>
            <p>Langkah <span id="current-step">1</span> dari <span id="total-steps">4</span></p>
        </div>

        <h1><i class="fas fa-heart heart-pulse"></i> Love Compatibility Analyzer</h1>
        <p class="subtitle">Temukan seberapa cocok Anda dengan pasangan potensial</p>
        
        <form id="predictionForm" action="/predict" method="post">
            <!-- Form sections with added tooltips -->
            
            <div class="form-section active" id="tab-1">
                <h3>Data Diri dan Pasangan</h3>
                <div class="form-group">
                    <label for="age">Usia Anda:</label>
                    <input type="number" id="age" name="age" min="18" max="99" required>
                </div>
                <div class="form-group">
                    <label for="age_o">Usia Pasangan:</label>
                    <input type="number" id="age_o" name="age_o" min="18" max="99" required>
                </div>
                <div class="form-group">
                    <label for="samerace">Apakah Anda dan Pasangan Satu Ras?</label>
                    <select id="samerace" name="samerace" required>
                        <option value="" disabled selected>Pilih salah satu</option>
                        <option value="1">Ya</option>
                        <option value="0">Tidak</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="go_out">Seberapa Sering Anda Keluar Rumah?</label>
                    <select id="go_out" name="go_out" required>
                        <option value="" disabled selected>Pilih salah satu</option>
                        <option value="1">Beberapa kali seminggu</option>
                        <option value="2">Sekali seminggu</option>
                        <option value="3">Dua kali sebulan</option>
                        <option value="4">Sekali sebulan</option>
                        <option value="5">Jarang</option>
                    </select>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Prioritas Anda pada Pasangan</h3>
                <div class="form-group slider-group">
                    <label class="slider-label" for="attr1_1">
                        Daya Tarik Fisik: <span id="attr1_1_val">{{ form_data.get('attr1_1', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting penampilan fisik pasangan bagi Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="attr1_1" name="attr1_1" min="1" max="10" value="{{ form_data.get('attr1_1', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="sinc1_1">
                        Ketulusan: <span id="sinc1_1_val">{{ form_data.get('sinc1_1', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting kejujuran dan ketulusan pasangan bagi Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="sinc1_1" name="sinc1_1" min="1" max="10" value="{{ form_data.get('sinc1_1', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="intel1_1">
                        Kecerdasan: <span id="intel1_1_val">{{ form_data.get('intel1_1', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting kecerdasan pasangan bagi Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="intel1_1" name="intel1_1" min="1" max="10" value="{{ form_data.get('intel1_1', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="fun1_1">
                        Sifat Menyenangkan: <span id="fun1_1_val">{{ form_data.get('fun1_1', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting kesenangan dan humor dalam diri pasangan bagi Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="fun1_1" name="fun1_1" min="1" max="10" value="{{ form_data.get('fun1_1', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="amb1_1">
                        Ambisi: <span id="amb1_1_val">{{ form_data.get('amb1_1', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting ambisi dan tujuan hidup pasangan bagi Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="amb1_1" name="amb1_1" min="1" max="10" value="{{ form_data.get('amb1_1', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="shar1_1">
                        Ketertarikan yang Sama: <span id="shar1_1_val">{{ form_data.get('shar1_1', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting memiliki minat yang sama dengan pasangan bagi Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="shar1_1" name="shar1_1" min="1" max="10" value="{{ form_data.get('shar1_1', 5) }}">
                </div>
            </div>
            
            <div class="form-section">
                <h3>Prioritas Pasangan pada Anda</h3>
                <div class="form-group slider-group">
                    <label class="slider-label" for="pf_o_att">
                        Daya Tarik Fisik: <span id="pf_o_att_val">{{ form_data.get('pf_o_att', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting Anda pikir pasangan menghargai daya tarik fisik Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="pf_o_att" name="pf_o_att" min="1" max="10" value="{{ form_data.get('pf_o_att', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="pf_o_sin">
                        Ketulusan: <span id="pf_o_sin_val">{{ form_data.get('pf_o_sin', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting Anda pikir pasangan menghargai ketulusan Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="pf_o_sin" name="pf_o_sin" min="1" max="10" value="{{ form_data.get('pf_o_sin', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="pf_o_int">
                        Kecerdasan: <span id="pf_o_int_val">{{ form_data.get('pf_o_int', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting Anda pikir pasangan menghargai kecerdasan Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="pf_o_int" name="pf_o_int" min="1" max="10" value="{{ form_data.get('pf_o_int', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="pf_o_fun">
                        Sifat Menyenangkan: <span id="pf_o_fun_val">{{ form_data.get('pf_o_fun', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting Anda pikir pasangan menghargai sifat menyenangkan Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="pf_o_fun" name="pf_o_fun" min="1" max="10" value="{{ form_data.get('pf_o_fun', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="pf_o_amb">
                        Ambisi: <span id="pf_o_amb_val">{{ form_data.get('pf_o_amb', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting Anda pikir pasangan menghargai ambisi Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="pf_o_amb" name="pf_o_amb" min="1" max="10" value="{{ form_data.get('pf_o_amb', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="pf_o_sha">
                        Ketertarikan yang Sama: <span id="pf_o_sha_val">{{ form_data.get('pf_o_sha', 5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting Anda pikir pasangan menghargai minat yang sama dengan Anda? (1 = Tidak penting, 10 = Sangat penting)"></i>
                    </label>
                    <input type="range" id="pf_o_sha" name="pf_o_sha" min="1" max="10" value="{{ form_data.get('pf_o_sha', 5) }}">
                </div>
            </div>

            <div class="form-section">
                <h3>Latar Belakang</h3>
                <div class="form-group slider-group">
                    <label class="slider-label" for="imprace">
                        Seberapa Penting Ras untuk Anda? <span id="imprace_val">{{ form_data.get('imprace', 5) }}</span> (1=Tidak penting, 10=Sangat penting)
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting faktor ras dalam memilih pasangan bagi Anda?"></i>
                    </label>
                    <input type="range" id="imprace" name="imprace" min="1" max="10" value="{{ form_data.get('imprace', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="imprelig">
                        Seberapa Penting Agama untuk Anda? <span id="imprelig_val">{{ form_data.get('imprelig', 5) }}</span> (1=Tidak penting, 10=Sangat penting)
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Seberapa penting faktor agama/kepercayaan dalam memilih pasangan bagi Anda?"></i>
                    </label>
                    <input type="range" id="imprelig" name="imprelig" min="1" max="10" value="{{ form_data.get('imprelig', 5) }}">
                </div>
                <div class="form-group slider-group">
                    <label class="slider-label" for="int_corr">
                        Skor Korelasi Minat: <span id="int_corr_val">{{ form_data.get('int_corr', 0.5) }}</span>
                        <i class="fas fa-info-circle tooltip-trigger" data-tooltip="Skor ini mengukur sejauh mana minat Anda dan pasangan saling terkait atau tumpang tindih. Semakin tinggi, semakin banyak minat yang sama."></i>
                    </label>
                    <input type="range" id="int_corr" name="int_corr" min="0" max="1" step="0.01" value="{{ form_data.get('int_corr', 0.5) }}">
                </div>
            </div>
            
            <div class="form-navigation">
                <button type="button" class="btn btn-secondary btn-disabled" id="prevBtn">Sebelumnya</button>
                <button type="button" class="btn" id="nextBtn">Selanjutnya</button>
            </div>
        </form>

        {% if result_title %}
        <!-- Enhanced result container -->
        <div class="result-container animate__animated animate__zoomIn">
            <div class="result-header">
                <h2><span class="animated-emoji">{{ result_emoji }}</span> {{ result_title }}</h2>
                <p class="romantic-subtitle">"{{ romantic_quote }}"</p>
            </div>

            <!-- Enhanced heart visualization -->
            <div class="heart-container">
                <div class="heart-progress-container">
                    <i class="fas fa-heart heart-progress" style="transform: scale({{ 0.5 + (prob_match * 0.5) }});"></i>
                    <div class="heart-percentage">{{ (prob_match * 100) | round }}%</div>
                </div>
                <input type="hidden" id="probMatchHidden" value="{{ prob_match }}">
            </div>
            
            <!-- Compatibility timeline -->
            <div class="compatibility-timeline">
                <div class="timeline-bar" style="width: {{ prob_match * 100 }}%;"></div>
                <div class="timeline-markers">
                    <div class="marker" data-percent="0">Awal</div>
                    <div class="marker" data-percent="25">Kenalan</div>
                    <div class="marker" data-percent="50">Teman</div>
                    <div class="marker" data-percent="75">Kekasih</div>
                    <div class="marker" data-percent="100">Soulmate</div>
                </div>
            </div>

            <!-- Enhanced analysis section -->
            <div class="analysis-section romantic-fade-in">
                <h3><i class="fas fa-heartbeat"></i> Analisis Kompatibilitas Romantis</h3>
                <div class="compatibility-grid">
                    {% for point in explanation_points %}
                    <div class="compatibility-item">
                        <div class="compatibility-icon">
                            <i class="fas fa-{% if loop.index0 == 0 %}percentage{% elif loop.index0 % 2 == 0 %}star{% else %}heart{% endif %}"></i>
                        </div>
                        <div class="compatibility-text">{{ point }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Enhanced love story section -->
            {% if love_story %}
            <div class="love-story animate__animated animate__fadeInUp">
                <div class="story-header">
                    <i class="fas fa-book-open"></i>
                    <h3>Kisah Cinta Kalian</h3>
                </div>
                <div class="story-content">{{ love_story | safe }}</div>
                <div class="story-footer">
                    <i class="fas fa-quote-right"></i>
                </div>
            </div>
            {% endif %}

            <div class="what-if-section">
                <h3><i class="fas fa-question-circle"></i> Eksperimen "Apa Jadinya Jika..."</h3>
                <p>Ubah beberapa nilai untuk melihat perubahan kecocokan:</p>
                
                <div class="what-if-controls">
                    <div class="form-group slider-group">
                        <label for="what-if-attr">Daya Tarik Fisik Anda:</label>
                        <input type="range" id="what-if-attr" min="1" max="10" 
                            value="{{ form_data.get('attr1_1', 5) }}"
                            data-original="{{ form_data.get('attr1_1', 5) }}">
                        <span id="what-if-attr-val">{{ form_data.get('attr1_1', 5) }}</span>
                    </div>
                    <div class="form-group slider-group">
                        <label for="what-if-fun">Nilai Keseruan:</label>
                        <input type="range" id="what-if-fun" min="1" max="10" 
                            value="{{ form_data.get('fun1_1', 5) }}"
                            data-original="{{ form_data.get('fun1_1', 5) }}">
                        <span id="what-if-fun-val">{{ form_data.get('fun1_1', 5) }}</span>
                    </div>
                    <div class="form-group slider-group">
                        <label for="what-if-intel">Kecerdasan:</label>
                        <input type="range" id="what-if-intel" min="1" max="10" 
                            value="{{ form_data.get('intel1_1', 5) }}"
                            data-original="{{ form_data.get('intel1_1', 5) }}">
                        <span id="what-if-intel-val">{{ form_data.get('intel1_1', 5) }}</span>
                    </div>
                </div>
                
                <button id="what-if-submit" class="btn">
                    <i class="fas fa-calculator"></i> Hitung Ulang
                </button>
                
                <div id="what-if-results" class="hidden">
                    <h4>Hasil Eksperimen:</h4>
                    <div class="result-comparison">
                        <div class="original-result">
                            <span>Hasil Awal:</span>
                            <div class="heart-container small">
                                <i class="fas fa-heart heart-progress" 
                                style="transform: scale({{ 0.5 + (prob_match * 0.5) }});"></i>
                                <div class="heart-percentage">{{ (prob_match * 100) | round }}%</div>
                            </div>
                        </div>
                        <div class="new-result">
                            <span>Hasil Baru:</span>
                            <div class="heart-container small">
                                <i class="fas fa-heart heart-progress"></i>
                                <div class="heart-percentage">0%</div>
                            </div>
                        </div>
                    </div>
                    <div class="what-if-explanation">
                        <p id="what-if-analysis"></p>
                    </div>
                </div>
            </div>

            <!-- Hidden field containing all form data for what-if calculations -->
            <input type="hidden" id="whatIfBaseData" 
                value="{{ form_data | tojson | safe }}">
            <input type="hidden" id="originalProbMatch" 
                value="{{ prob_match }}">

            <div class="date-ideas">
                <h3><i class="fas fa-lightbulb"></i> Ide Kencan Personal untuk Kalian</h3>
                <div class="ideas-container">
                    {% for idea in date_ideas %}
                    <div class="idea-card">
                        <div class="idea-icon">
                            {% if loop.index0 == 0 %}üç≥
                            {% elif loop.index0 == 1 %}üé≠
                            {% else %}üåÜ{% endif %}
                        </div>
                        <div class="idea-text">{{ idea }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Add this in the result section -->
            <div class="chart-container">
                <h3><i class="fas fa-chart-pie"></i> Perbandingan Prioritas</h3>
                <canvas id="priorityChart"></canvas>
            </div>

            <div class="feedback-section">
                <h4>Apakah prediksi ini akurat?</h4>
                <form id="feedbackForm" action="/feedback" method="post">
                    <input type="hidden" name="prediction_result" value="{{ 'Match' if prob_match >= 0.5 else 'No Match' }}">
                    <div class="feedback-buttons">
                        <button type="submit" name="is_accurate" value="true" class="accurate">Ya, Cocok!</button>
                        <button type="submit" name="is_accurate" value="false" class="inaccurate">Tidak Cocok</button>
                    </div>
                </form>
            </div>

        </div>
        {% endif %}
    </div>

    <!-- Tooltip container -->
    <div id="tooltip" class="tooltip"></div>

    <!-- Confetti canvas (for high compatibility results) -->
    {% if prob_match and prob_match > 0.7 %}
    <canvas id="confetti-canvas"></canvas>
    {% endif %}

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/confetti.js/0.0.1/confetti.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='js/salju.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app_logic.js') }}"></script>
    <!-- Add hidden field to store original form data -->
    <input type="hidden" id="originalFormDataHidden" value="{{ form_data | tojson | safe }}">
</body>
</html>
